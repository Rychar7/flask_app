<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fotos Capturadas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
</head>
<body>

<!-- Cabecera -->
<header class="bg-primary text-white p-3 mb-4">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="h4 mb-0">Aplicación</h1>
            <nav class="d-flex gap-3">
                <a href="{{ url_for('home') }}" class="text-white text-decoration-none">Inicio</a>
                <a href="{{ url_for('obtener_fotos') }}" class="text-white text-decoration-none">Fotos Capturadas</a>
                <a href="{{ url_for('obtener_temperatura') }}" class="text-white text-decoration-none">Temperatura en Tiempo Real</a>
                <a href="{{ url_for('logout') }}" class="text-white text-decoration-none">Cerrar sesión</a>
            </nav>
        </div>
    </div>
</header>

<div class="container">
    <h2 class="text-center mb-4">Fotos Capturadas</h2>

    <!-- Gráfico circular -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-6">
            <canvas id="photosChart"></canvas>
        </div>
    </div>

    <!-- Fotos por Mes -->
    <div class="accordion" id="photosAccordion">
        {% for month, photos in photos_by_month.items() %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ month }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ month }}" aria-expanded="false" aria-controls="collapse{{ month }}">
                    {{ month }}
                </button>
            </h2>
            <div id="collapse{{ month }}" class="accordion-collapse collapse" aria-labelledby="heading{{ month }}" data-bs-parent="#photosAccordion">
                <div class="accordion-body">
                    <div class="d-flex flex-wrap gap-3">
                        {% for photo in photos %}
                        <img src="{{ photo['url'] }}" class="photo-thumbnail" alt="Foto {{ month }}" onclick="openImageModal('{{ photo['url'] }}')">
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Modal para Vista Completa de Imágenes -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-body p-0">
                <img id="modalImage" src="" class="img-fluid" alt="Vista completa">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Datos para el gráfico circular
    const photosData = {{ photos_data_json | safe }};
    const ctx = document.getElementById('photosChart').getContext('2d');
    const photosChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: Object.keys(photosData),
            datasets: [{
                data: Object.values(photosData),
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'],
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                }
            }
        }
    });

    // Función para abrir el modal con la imagen en vista completa
    function openImageModal(url) {
        document.getElementById('modalImage').src = url;
        var imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
        imageModal.show();
    }
</script>

<style>
    /* Estilos para las miniaturas de fotos */
    .photo-thumbnail {
        width: 100px;
        height: auto;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .photo-thumbnail:hover {
        transform: scale(1.1);
    }
</style>

</body>
</html>
